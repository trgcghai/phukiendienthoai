<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="../assets/bootstrap-5.3.3-dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="../css/library.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <link rel="stylesheet" href="../css/login.css" />
    <script src="../assets/bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>
    <script src="../js/jquery-3.7.1.min.js"></script>
    <title>Đăng nhập</title>
  </head>
  <body>
    <header
      class="header position-fixed top-0 start-0 end-0 z-1 d-flex align-items-center justify-content-center"
    >
      <div
        class="header_container container p-0 d-flex align-items-center justify-content-between"
      >
        <div class="logo">
          <a
            href="../index.html"
            class="header_link d-block text-light cursor-pointer text-decoration-none"
            >Phukiendienthoai</a
          >
        </div>
      </div>
    </header>

    <main class="main">
      <div class="form login_form">
        <h2 class="form_title">Đăng nhập</h2>
        <div class="form_ask">
          Chưa có tài khoản ?
          <button class="form_link toSignUp">Đăng ký tại đây</button>
        </div>
        <form>
          <div class="form_section mb-3">
            <label for="login_username" class="form-label">Username</label>
            <input
              required
              type="text"
              class="form-control"
              id="login_username"
              aria-describedby="login-usernameHelp"
            />
            <div id="login-usernameHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3">
            <label for="login_password" class="form-label">Mật khẩu</label>
            <input
              required
              type="password"
              class="form-control"
              id="login_password"
              aria-describedby="passwordHelp"
            />
            <div id="passwordHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3">
            <span class="form_forgetPassword">Quên mật khẩu ?</span>
          </div>
          <div class="form_section d-grid">
            <button class="btn btn-primary submit_btn login_btn">
              Đăng nhập
            </button>
          </div>
        </form>
      </div>

      <div class="form signup_form">
        <h2 class="form_title">Đăng ký</h2>
        <div class="form_ask">
          Đã có tài khoản ?
          <button class="form_link toLogin">Đăng nhập tại đây</button>
        </div>
        <form class="row p-0 m-0">
          <div class="form_section mb-3">
            <label for="signup_email" class="form-label">Email</label>
            <input
              required
              type="email"
              class="form-control"
              id="signup_email"
              aria-describedby="signup-emailHelp"
            />
            <div id="signup-emailHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3">
            <label for="signup_username" class="form-label">Username</label>
            <input
              required
              type="text"
              class="form-control"
              id="signup_username"
              aria-describedby="signup-usernameHelp"
            />
            <div id="signup-usernameHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3">
            <label for="signup_password" class="form-label">Mật khẩu</label>
            <input
              required
              type="password"
              class="form-control"
              id="signup_password"
              aria-describedby="signup-passwordHelp"
            />
            <div id="signup-passwordHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3">
            <label for="signup_cfpassword" class="form-label"
              >Nhập lại mật khẩu</label
            >
            <input
              required
              type="password"
              class="form-control"
              id="signup_cfpassword"
              aria-describedby="cfpasswordHelp"
            />
            <div id="cfpasswordHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3 d-grid">
            <button class="btn btn-primary submit_btn signup_btn">
              Đăng ký
            </button>
          </div>
          <div class="form_section">
            <span class="form_policy"
              >Bằng việc đăng ký, bạn đã đồng ý với chúng tôi về
              <span class="policy">Điều khoản dịch vụ</span> &
              <span class="policy">Chính sách bảo mật</span>
            </span>
          </div>
        </form>
      </div>

      <div class="form resetPassword_form">
        <div class="form_back_btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="22"
            width="22"
            viewBox="0 0 448 512"
            class="form_icon"
          >
            <path
              d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"
            />
          </svg>
        </div>
        <h2 class="form_title mb-3">Đặt lại mật khẩu</h2>
        <form>
          <div class="form_section mb-3">
            <label for="reset_password" class="form-label">Mật khẩu mới</label>
            <input
              required
              type="password"
              class="form-control"
              id="reset_password"
              aria-describedby="reset-passwordHelp"
            />
            <div id="reset-passwordHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3">
            <label for="reset_cfpassword" class="form-label"
              >Nhập lại mật khẩu</label
            >
            <input
              required
              type="password"
              class="form-control"
              id="reset_cfpassword"
              aria-describedby="reset-cfpasswordHelp"
            />
            <div id="reset-cfpasswordHelp" class="form-text"></div>
          </div>
          <div class="form_section mb-3 mt-4 d-grid">
            <button class="btn btn-primary submit_btn confirm_btn">
              Xác nhận
            </button>
          </div>
        </form>
      </div>
    </main>

    <footer
      class="footer clearfix position-absolute bottom-0 w-100 text-light d-flex align-items-center justify-content-center"
      style="background-color: var(--main-color)"
    >
      <div
        class="footer_container p-0 m-0 container d-flex align-items-center justify-content-center p-0"
      >
        <div class="copyright" style="color: #fff !important">
          © 2024 - Bản quyền thuộc về Phukiendienthoai
        </div>
      </div>
    </footer>

    <script>
      $(document).ready(() => {
        const redirectLoginBtn = $(".toLogin");
        const redirectSignUpBtn = $(".toSignUp");
        const resetPasswordBtn = $(".form_forgetPassword");
        const submitLogin = $(".login_btn");
        const submitSignUp = $(".signup_btn");
        const backBtn = $(".form_back_btn");
        const submitReset = $(".confirm_btn");

        const resetLoginForm = () => {
          $("#login-usernameHelp").text("");
          $("#passwordHelp").text("");
          $("#login_username").css("border", "1px solid #ccc");
          $("#login_password").css("border", "1px solid #ccc");
          $("#login_username").val("");
          $("#login_password").val("");
        };

        const resetSignUpForm = () => {
          $("#signup-emailHelp").text("");
          $("#signup-usernameHelp").text("");
          $("#signup-passwordHelp").text("");
          $("#cfpasswordHelp").text("");

          $("#signup_username").css("border", "1px solid #ccc");
          $("#signup_email").css("border", "1px solid #ccc");
          $("#signup_password").css("border", "1px solid #ccc");
          $("#signup_cfpassword").css("border", "1px solid #ccc");

          $("#signup_username").val("");
          $("#signup_email").val("");
          $("#signup_password").val("");
          $("#signup_cfpassword").val("");
        };

        const resetChangePassForm = () => {
          $("#reset-passwordHelp").text("");
          $("#reset-cfpasswordHelp").text("");
          $("#reset_password").css("border", "1px solid #ccc");
          $("#reset_cfpassword").css("border", "1px solid #ccc");
          $("#reset_password").val("");
          $("#reset_cfpassword").val("");
        };

        backBtn.click(() => {
          $(".resetPassword_form").css("display", "none");
          $(".login_form").css("display", "block");
          resetLoginForm();
        });

        resetPasswordBtn.click(() => {
          $(".login_form").css("display", "none");
          $(".resetPassword_form").css("display", "block");
          resetChangePassForm();
        });

        redirectSignUpBtn.click(() => {
          $(".login_form").css("display", "none");
          $(".signup_form").css("display", "block");
          resetSignUpForm();
        });

        redirectLoginBtn.click(() => {
          $(".login_form").css("display", "block");
          $(".signup_form").css("display", "none");
          resetLoginForm();
        });

        const handleLogin = () => {
          const username = $("#login_username");
          const password = $("#login_password");

          let valid = true;

          if (
            username.val().trim().length === 0 ||
            !/^[a-zA-Z0-9]+$/.test(username.val())
          ) {
            const usernameText = $("#login-usernameHelp");
            usernameText.css("color", "red");
            usernameText.text("Username không hợp lệ!! Vui lòng thử lại");
            username.css("border", "1px solid red");
            valid = false;
          } else {
            const usernameText = $("#login-usernameHelp");
            usernameText.css("color", "green");
            usernameText.text("Chính xác !!");
            username.css("border", "1px solid green");
          }

          if (password.val() !== "12345678") {
            const passwordText = $("#passwordHelp");
            passwordText.css("color", "red");
            passwordText.text("Mật khẩu không chính xác!! Vui lòng thử lại");
            password.css("border", "1px solid red");
            valid = false;
          } else {
            const passwordText = $("#passwordHelp");
            passwordText.css("color", "green");
            passwordText.text("Chính xác !!");
            password.css("border", "1px solid green");
          }

          if (!valid) {
            return;
          }

          localStorage.setItem(
            "user",
            JSON.stringify({ name: username.val() })
          );
          window.location.href = "../index.html";
          username.val("");
          password.val("");
        };
        submitLogin.click((e) => {
          console.log("login..");
          e.preventDefault();
          handleLogin();
        });

        const handleSignUp = () => {
          const email = $("#signup_email");
          const username = $("#signup_username");
          const password = $("#signup_password");
          const cfpassword = $("#signup_cfpassword");
          let valid = true;

          if (!/\S+@\S+\.\S+/.test(email.val())) {
            const emailText = $("#signup-emailHelp");
            emailText.css("color", "red");
            emailText.text("Email không hợp lệ!! Vui lòng thử lại");
            email.css("border", "1px solid red");
            valid = false;
          } else {
            const emailText = $("#signup-emailHelp");
            emailText.css("color", "green");
            emailText.text("Email hợp lệ");
            email.css("border", "1px solid green");
          }
          if (
            username.val().trim().length === 0 ||
            !/^[a-zA-Z0-9]+$/.test(username.val())
          ) {
            const usernameText = $("#signup-usernameHelp");
            usernameText.css("color", "red");
            usernameText.text("Username không hợp lệ!! Vui lòng thử lại");
            username.css("border", "1px solid red");
            valid = false;
          } else {
            const usernameText = $("#signup-usernameHelp");
            usernameText.css("color", "green");
            usernameText.text("Username hợp lệ");
            username.css("border", "1px solid green");
          }
          if (
            password.val().trim().length < 8 ||
            password.val().trim().length > 20
          ) {
            const passwordText = $("#signup-passwordHelp");
            passwordText.css("color", "red");
            passwordText.text("Mật khẩu phải từ 8 đến 20 kí tự");
            password.css("border", "1px solid red");
            valid = false;
          } else {
            const passwordText = $("#signup-passwordHelp");
            passwordText.css("color", "green");
            passwordText.text("Mật khẩu hợp lệ");
            password.css("border", "1px solid green");
          }
          if (
            cfpassword.val().trim().length < 8 ||
            cfpassword.val().trim().length > 20
          ) {
            const cfpasswordText = $("#cfpasswordHelp");
            cfpasswordText.css("color", "red");
            cfpasswordText.text("Mật khẩu phải từ 8 đến 20 kí tự");
            cfpassword.css("border", "1px solid red");
            valid = false;
          } else {
            if (password.val().trim() !== cfpassword.val().trim()) {
              const cfpasswordText = $("#cfpasswordHelp");
              cfpasswordText.css("color", "red");
              cfpasswordText.text("Mật khẩu không trùng khớp");
              cfpassword.css("border", "1px solid red");
              valid = false;
            } else {
              const cfpasswordText = $("#cfpasswordHelp");
              cfpasswordText.css("color", "green");
              cfpasswordText.text("Mật khẩu trùng khớp");
              cfpassword.css("border", "1px solid green");
            }
          }

          if (!valid) {
            return;
          }

          localStorage.setItem(
            "user",
            JSON.stringify({ name: username.val(), email: email.val() })
          );
          window.location.href = "../index.html";
          email.val("");
          password.val("");
          cfpassword.val("");
        };
        submitSignUp.click((e) => {
          e.preventDefault();
          handleSignUp();
        });

        const handleResetPass = () => {
          const password = $("#reset_password");
          const cfpassword = $("#reset_cfpassword");

          if (
            password.val().trim().length < 8 ||
            password.val().trim().length > 20
          ) {
            const passwordText = $("#reset-passwordHelp");
            passwordText.css("color", "red");
            passwordText.text("Mật khẩu phải từ 8 đến 20 kí tự");
            password.css("border", "1px solid red");
          } else {
            const passwordText = $("#reset-passwordHelp");
            passwordText.css("color", "green");
            passwordText.text("Mật khẩu hợp lệ");
            password.css("border", "1px solid green");
          }
          if (
            cfpassword.val().trim().length < 8 ||
            cfpassword.val().trim().length > 20
          ) {
            const cfpasswordText = $("#reset-cfpasswordHelp");
            cfpasswordText.css("color", "red");
            cfpasswordText.text("Mật khẩu phải từ 8 đến 20 kí tự");
            cfpassword.css("border", "1px solid red");
            return;
          } else {
            if (password.val().trim() !== cfpassword.val().trim()) {
              const cfpasswordText = $("#reset-cfpasswordHelp");
              cfpasswordText.css("color", "red");
              cfpasswordText.text("Mật khẩu không trùng khớp");
              cfpassword.css("border", "1px solid red");
              return;
            } else {
              const cfpasswordText = $("#reset-cfpasswordHelp");
              cfpasswordText.css("color", "green");
              cfpasswordText.text("Mật khẩu trùng khớp");
              cfpassword.css("border", "1px solid green");
            }
          }

          $(".resetPassword_form").css("display", "none");
          $(".login_form").css("display", "block");
          resetLoginForm();

          password.val("");
          cfpassword.val("");
        };
        submitReset.click((e) => {
          e.preventDefault();
          handleResetPass();
        });
      });
    </script>
  </body>
</html>
