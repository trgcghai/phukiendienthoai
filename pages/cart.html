<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="../assets/bootstrap-5.3.3-dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="../css/library.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <link rel="stylesheet" href="../css/cart.css" />
    <script src="../assets/bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>
    <script src="../js/jquery-3.7.1.min.js"></script>
    <title>Giỏ hàng</title>
  </head>
  <body class="position-relative">
    <header
      class="header position-fixed top-0 start-0 end-0 z-1 d-flex align-items-center justify-content-center"
    >
      <div
        class="header_container container p-0 d-flex align-items-center justify-content-between"
      >
        <div class="logo">
          <a
            href="../index.html"
            class="header_link d-block text-light cursor-pointer text-decoration-none"
            >Phukiendienthoai</a
          >
        </div>

        <div
          class="categories d-none d-sm-none d-md-none d-lg-flex d-xl-flex d-xxl-flex align-items-center justify-content-between text-light cursor-pointer"
        >
          <div class="category_icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 512 512"
            >
              <path
                fill="white"
                d="M40 48C26.7 48 16 58.7 16 72v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V72c0-13.3-10.7-24-24-24H40zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zM16 232v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V232c0-13.3-10.7-24-24-24H40c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V392c0-13.3-10.7-24-24-24H40z"
              />
            </svg>
          </div>
          <span class="categories_text">Danh mục</span>
        </div>

        <div
          class="search_box d-none d-sm-flex d-md-flex d-lg-flex d-xl-flex d-xxl-flex align-items-center position-relative"
        >
          <input
            type="text"
            class="search_input border-0"
            placeholder="Bạn cần tìm gì ?"
          />
          <div class="search_icon position-absolute cursor-pointer">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 512 512"
            >
              <path
                fill="gray"
                d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"
              />
            </svg>
          </div>
        </div>

        <div
          class="cart d-none d-sm-block d-md-block d-lg-block d-xl-block d-xxl-block"
        >
          <a
            href="./cart.html"
            class="cart_link text-decoration-none d-flex align-items-center text-light cursor-pointer"
          >
            <div class="cart_icon">
              <svg
                viewBox="0 0 20 20"
                width="23"
                height="23"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M4.22111 3L3.84216 1H1M4.22111 3H19L15.2105 12.0455H5.73689M4.22111 3L5.73689 12.0455M5.73689 12.0455L3.56458 13.293C2.96774 13.923 3.5309 14.9091 4.375 14.9091H9.625H12.25L15.2105 15M15.2105 15C14.708 15 14.2261 15.2107 13.8708 15.5858C13.5154 15.9609 13.3158 16.4696 13.3158 17C13.3158 17.5304 13.5154 18.0391 13.8708 18.4142C14.2261 18.7893 14.708 19 15.2105 19C15.7131 19 16.195 18.7893 16.5503 18.4142C16.9056 18.0391 17.1053 17.5304 17.1053 17C17.1053 16.4696 16.9056 15.9609 16.5503 15.5858C16.195 15.2107 15.7131 15 15.2105 15ZM7.63162 17C7.63162 17.5304 7.432 18.0391 7.07667 18.4142C6.72134 18.7893 6.2394 19 5.73689 19C5.23438 19 4.75245 18.7893 4.39711 18.4142C4.04178 18.0391 3.84216 17.5304 3.84216 17C3.84216 16.4696 4.04178 15.9609 4.39711 15.5858C4.75245 15.2107 5.23438 15 5.73689 15C6.2394 15 6.72134 15.2107 7.07667 15.5858C7.432 15.9609 7.63162 16.4696 7.63162 17Z"
                  stroke="white"
                  stroke-width="1.7"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </div>
            <span class="cart_link_text">Giỏ hàng</span>
          </a>
        </div>

        <div
          class="user d-none d-sm-block d-md-block d-lg-block d-xl-block d-xxl-block"
        >
          <a
            href="./login.html"
            class="user_link d-flex align-items-center justify-content-between text-light cursor-pointer text-decoration-none"
          >
            <div class="user_icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="23"
                height="23"
                viewBox="0 0 448 512"
              >
                <path
                  fill="white"
                  d="M304 128a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM49.3 464H398.7c-8.9-63.3-63.3-112-129-112H178.3c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3z"
                />
              </svg>
            </div>
            <span class="user_text">Đăng nhập</span>
          </a>
        </div>

        <div
          class="icon_toggle d-block d-sm-none d-md-none d-lg-none d-xl-none d-xxl-none"
        >
          <div class="icon px-3" style="cursor: pointer">
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
              onclick="document.querySelector('.toggle_list').classList.toggle('d-none')"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="22"
                viewBox="0 0 512 512"
              >
                <path
                  fill="white"
                  d="M40 48C26.7 48 16 58.7 16 72v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V72c0-13.3-10.7-24-24-24H40zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zM16 232v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V232c0-13.3-10.7-24-24-24H40c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V392c0-13.3-10.7-24-24-24H40z"
                />
              </svg>
            </button>
          </div>

          <ul
            class="d-none toggle_list position-absolute start-0 list-unstyled w-100"
          >
            <li class="toggle_item py-2 position-relative">
              <input
                type="text"
                class="search_input border-0 w-100"
                placeholder="Bạn cần tìm gì ?"
              />
              <div
                class="position-absolute cursor-pointer"
                style="right: 12px; top: 13px"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 512 512"
                  style="cursor: pointer"
                >
                  <path
                    fill="gray"
                    d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"
                  />
                </svg>
              </div>
            </li>
            <li class="toggle_item text-light py-2 collapse_categories">
              Danh mục
            </li>

            <li class="toggle_item text-light py-2">
              <a
                href="./cart.html"
                class="toggle_link px-0 cart_link d-inline-block w-100 text-decoration-none text-light"
                >Giỏ hàng</a
              >
            </li>
            <li class="toggle_item text-light py-2">
              <a
                href="./login.html"
                class="toggle_link px-0 border-0 user_link d-inline-block w-100 text-decoration-none text-light"
                >Đăng nhập</a
              >
            </li>
          </ul>
        </div>
      </div>
    </header>

    <main class="container position-relative">
      <div
        class="row mx-0 mb-4 p-2 bg-white"
        style="border: 1px solid #ccc; border-radius: 8px"
      >
        <div class="col p-0 fs-6 col-xxl-4 col-xl-4 col-lg-4 col-md-3">
          <input type="checkbox" class="me-1" id="checkAllProduct" />
          <span>Sản phẩm</span>
        </div>
        <div
          class="col p-0 fs-6 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 d-none d-sm-none d-md-block"
        >
          Đơn giá
        </div>
        <div
          class="col p-0 fs-6 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-3 d-none d-sm-none d-md-block"
        >
          Số lượng
        </div>
        <div
          class="col p-0 fs-6 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 d-none d-sm-none d-md-block"
        >
          Thành tiền
        </div>
        <div
          class="col p-0 fs-6 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 d-none d-sm-none d-md-block"
        >
          Thao tác
        </div>
      </div>

      <div
        class="cart_product_container container p-2 my-2 bg-white"
        style="border-radius: 8px; border: 1px solid #ccc"
      ></div>

      <div
        class="pay_section row mx-0 mb-4 p-2 bg-white"
        style="border: 1px solid #ccc; border-radius: 8px"
      >
        <div
          class="col p-0 fs-5 col-xxl-8 col-xl-8 col-lg-8 col-md-8 col-sm-8 col-5 d-flex d-sm-flex align-items-center justify-content-start"
        >
          Tổng tiền
        </div>
        <div
          class="col p-0 fs-5 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 col-sm-2 col-5 d-flex d-sm-flex align-items-center justify-content-center"
        >
          <span class="total_price">0 VNĐ</span>
        </div>
        <div
          class="col p-0 text-center d-grid col-xxl-2 col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2"
        >
          <span class="pay_btn text-white" style="cursor: pointer"
            >Thanh toán</span
          >
        </div>
      </div>

      <div
        class="categories_list_container position-absolute d-none"
        style="top: 12px; right: 0; left: 0"
      >
        <ul class="categories_list row m-0">
          <li
            class="categories_item p-0 col col-6 col-md-4 col-lg-2 col-xl-2 col-xxl-2"
          >
            <a href="./allBoSacProducts.html" class="categories_item_link"
              >Bộ sạc</a
            >
          </li>
          <li
            class="categories_item p-0 col col-6 col-md-4 col-lg-2 col-xl-2 col-xxl-2"
          >
            <a href="./allDaySacProducts.html" class="categories_item_link"
              >Dây sạc</a
            >
          </li>
          <li
            class="categories_item p-0 col col-6 col-md-4 col-lg-2 col-xl-2 col-xxl-2"
          >
            <a href="./allPinDuPhongProducts.html" class="categories_item_link"
              >Pin dự phòng</a
            >
          </li>
          <li
            class="categories_item p-0 col col-6 col-md-4 col-lg-2 col-xl-2 col-xxl-2"
          >
            <a href="./allTaiNgheProducts.html" class="categories_item_link"
              >Tai nghe</a
            >
          </li>
          <li
            class="categories_item p-0 col col-6 col-md-4 col-lg-2 col-xl-2 col-xxl-2"
          >
            <a href="./allAppleProducts.html" class="categories_item_link"
              >Phụ kiện Apple</a
            >
          </li>
          <li
            class="categories_item p-0 col col-6 col-md-4 col-lg-2 col-xl-2 col-xxl-2"
          >
            <a href="./allOtherProducts.html" class="categories_item_link"
              >Khác
            </a>
          </li>
        </ul>
      </div>
    </main>

    <footer
      class="footer clearfix position-absolute bottom-0 w-100 text-light d-flex align-items-center justify-content-center"
    >
      <div
        class="footer_container container d-flex align-items-center justify-content-center p-0"
      >
        <div class="copyright">
          © 2024 - Bản quyền thuộc về Phukiendienthoai
        </div>
      </div>
    </footer>

    <div class="backdrop"></div>

    <script>
      $(document).ready(() => {
        const username = localStorage.getItem("userName");
        const userLink = $(".user_link");
        const userText = $(".user_text");
        const trackOrderLink = $(".track_order_link");
        const cartLink = $(".cart_link");

        if (username !== null) {
          userText.text(
            username.length >= 10 ? username.substring(0, 11) + "..." : username
          );
          userLink.each((index, elem) => {
            $(elem).attr("href", "./userPage.html");
            if (index !== 0) {
              $(elem).text(
                username.length >= 10
                  ? username.substring(0, 11) + "..."
                  : username
              );
            }
          });
        } else {
          trackOrderLink.each((index, elem) => {
            $(elem).attr("href", "./login.html");
          });

          cartLink.each((index, elem) => {
            $(elem).attr("href", "./login.html");
          });
        }
      });
    </script>

    <script src="../js/handleCategoryModal.js"></script>

    <script>
      const categoriesShow = $(".categories");
      categoriesShow.click(() => {
        $(".categories_list_container").removeClass("d-none");
      });

      const backdropHide = $(".backdrop");
      backdropHide.click(() => {
        $(".categories_list_container").addClass("d-none");
      });
    </script>

    <script type="module">
      import { all } from "../assets/images/prepareData.js";

      $(document).ready(() => {
        function loadDataFromCart() {
          const cart = JSON.parse(localStorage.getItem("cart"));
          if (cart.length === 0) {
            $(".cart_product_container").html(
              '<div class="d-flex align-items-center justify-content-center">' +
                '<img src="../assets/images/empty-cart.png" alt="empty cart" /></div>'
            );

            $(".pay_section").addClass("d-none");
          } else {
            let html = "";

            cart.forEach((item) => {
              const product = all.find((prod) => prod.id == item.productId);
              html += `
              <div class="product_container row mx-0 mb-2 py-2">
                <div class="col p-0 col-xxl-4 col-xl-4 col-lg-4 col-md-3 col-sm-6 col-8 d-flex gap-1">
                  <input type="checkbox" class="checkBoxProduct me-1" id="checkProduct-${
                    product.id
                  }" />
                  <div class="product_info d-xxl-flex d-xl-flex d-lg-flex d-md-block d-sm-flex d-flex align-items-center">
                    <img
                      src="../assets/images/${product.image}"
                      class="product_image mx-3"
                      height="80"
                      alt="${product.ten}"
                    />
                    <div class="product_name" style="cursor:pointer;">
                      <a href="./detailProduct.html" aria-id="${
                        product.id
                      }" class="link_to_product text-dark text-decoration-none d-inline-block">${
                product.ten
              }</a>
                    </div>
                  </div>
                </div>
                <div class="col p-0 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 col-sm-6 col-4">
                  <div
                    class="product_price d-flex align-items-center justify-content-center h-100"
                  >
                    ${
                      product.gia.toLocaleString("en", {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 3,
                      }) + " VND"
                    }
                  </div>
                </div>
                <div class="col p-0 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-3 col-sm-4 col-6">
                  <div
                    class="product_quantity d-flex align-items-center justify-content-center h-100"
                  >
                    <div class="input-group d-flex align-items-center justify-content-center">
                      <button class="btn btn-outline minus_btn" id="${
                        product.id
                      }-minus" type="button">
                        -
                      </button>
                      <input
                        type="text"
                        class="form-control quantity_input"
                        style="text-align: center"
                        value="${item.quantity}"
                        id="${product.id}-quantity"
                        aria-label="Example text with two button addons"
                      />
                      <button class="btn btn-outline add_btn" id="${
                        product.id
                      }-add" type="button">
                        +
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col p-0 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 col-sm-4 col-4">
                  <div
                    class="product_total d-flex align-items-center justify-content-center h-100"
                    id="${product.id}-total"
                    aria-price="${product.gia}"
                  >
                  ${
                    (product.gia * item.quantity).toLocaleString("en", {
                      minimumFractionDigits: 0,
                      maximumFractionDigits: 3,
                    }) + " VND"
                  }
                  </div>
                </div>
                <div class="col p-0 text-center col-xxl-2 col-xl-2 col-lg-2 col-md-2 col-sm-4 col-2">
                  <div
                    class="remove_btn_container d-flex align-items-center justify-content-center h-100"
                  >
                    <button
                      type="button"
                      class="remove_btn border-0 bg-white"
                      style="outline: none; cursor-pointer"
                      id="${product.id}"
                    >
                      Xóa
                    </button>
                  </div>
                </div>
              </div>
              `;
            });

            $(".cart_product_container").html(html);
          }
        }
        loadDataFromCart();

        const checkAllBtn = $("#checkAllProduct");
        const removeBtns = $(".remove_btn");
        const addBtns = $(".add_btn");
        const minusBtns = $(".minus_btn");
        const checkBoxProducts = $(".checkBoxProduct");
        const linkToProducts = $(".link_to_product");

        removeBtns.each((index, button) => {
          $(button).click(() => {
            const id = button.id;
            let cart = localStorage.getItem("cart");
            if (cart !== null) {
              cart = JSON.parse(cart);
              cart = cart.filter((item) => item.productId !== id);
              localStorage.setItem("cart", JSON.stringify(cart));
            }

            window.location.reload();
          });
        });

        linkToProducts.each((index, link) => {
          $(link).on("click", () => {
            localStorage.setItem("productId", link.getAttribute("aria-id"));
            window.location.href = "./detailProduct.html";
          });
        });

        const updateTotalPrice = () => {
          let totalPrice = 0;
          const checkBoxProducts = $(".checkBoxProduct");
          checkBoxProducts.each((index, item) => {
            if (item.checked) {
              const singlePrice = item.parentNode.parentNode
                .querySelector(".product_total")
                .getAttribute("aria-price");
              const quantity =
                item.parentNode.parentNode.querySelector(
                  ".quantity_input"
                ).value;
              totalPrice += parseInt(singlePrice) * parseInt(quantity);
            }
          });
          $(".total_price").text(
            totalPrice.toLocaleString("en", {
              minimumFractionDigits: 0,
              maximumFractionDigits: 3,
            }) + " VND"
          );
        };

        addBtns.each((index, button) => {
          $(button).click(() => {
            const productId = button.id.split("-")[0];
            const quantityInput = $(`#${productId}-quantity`);
            quantityInput.val(parseInt(quantityInput.val()) + 1);

            const productTotal = $(`#${productId}-total`);
            productTotal.text(
              (
                parseInt(productTotal.attr("aria-price")) *
                parseInt(quantityInput.val())
              ).toLocaleString("en", {
                minimumFractionDigits: 0,
                maximumFractionDigits: 3,
              }) + " VND"
            );

            let cart = JSON.parse(localStorage.getItem("cart"));
            cart.forEach((item) => {
              if (item.productId == productId) {
                item.quantity = quantityInput.val();
              }
            });

            localStorage.setItem("cart", JSON.stringify(cart));
          });
        });

        minusBtns.each((index, button) => {
          $(button).click(() => {
            const productId = button.id.split("-")[0];
            const quantityInput = $(`#${productId}-quantity`);
            quantityInput.val(
              parseInt(quantityInput.val()) - 1 <= 0
                ? 1
                : parseInt(quantityInput.val()) - 1
            );

            const productTotal = $(`#${productId}-total`);
            productTotal.text(
              (
                parseInt(productTotal.attr("aria-price")) *
                parseInt(quantityInput.val())
              ).toLocaleString("en", {
                minimumFractionDigits: 0,
                maximumFractionDigits: 3,
              }) + " VND"
            );

            let cart = JSON.parse(localStorage.getItem("cart"));
            cart.forEach((item) => {
              if (item.productId == productId) {
                item.quantity = quantityInput.val();
              }
            });

            localStorage.setItem("cart", JSON.stringify(cart));
          });
        });

        checkAllBtn.change(() => {
          if (checkAllBtn.prop("checked")) {
            const checkBoxProducts = $(".checkBoxProduct");
            checkBoxProducts.each((index, item) => {
              item.checked = true;
            });

            updateTotalPrice();
          } else {
            const checkBoxProducts = $(".checkBoxProduct");
            checkBoxProducts.each((index, item) => {
              item.checked = false;
            });
            updateTotalPrice();
          }
        });

        checkBoxProducts.each((index, item) => {
          item.addEventListener("change", () => {
            const allChecked =
              checkBoxProducts.length ===
              checkBoxProducts.filter((index, item) => item.checked).length;
            checkAllBtn.prop("checked", allChecked);

            updateTotalPrice();
          });
        });
      });
    </script>

    <script type="module" src="../js/handleSearchBar.js"></script>
  </body>
</html>
